%%
%% Paul Landes  12/24/2013
%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{zenlisting}[2011/02/04 Code Listing Functions]


%% -- code snippets
% include the lines below to use a nicer fixed-width font than the default one
%\usepackage{fontspec}
%\setmonofont[Scale=0.8]{Consolas} 
\usepackage{listings}
\usepackage{color}
\usepackage{textcomp}
\definecolor{listinggray}{gray}{0.9}
\definecolor{lbcolor}{rgb}{0.95,0.95,0.95}
\lstset{%
	backgroundcolor=\color{lbcolor},
%	rulecolor=\color{black},
	tabsize=4,
        basicstyle=\footnotesize,
        upquote=true,
        aboveskip={1.5\baselineskip},
%        columns=fixed,
        showstringspaces=false,
        extendedchars=true,
        breaklines=true,
        prebreak = \raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
        frame=single,
        showtabs=false,
        showspaces=false,
        showstringspaces=false,
%        identifierstyle=\ttfamily,
        keywordstyle=\color[rgb]{0,0,1},
        commentstyle=\color[rgb]{0.133,0.545,0.133},
        stringstyle=\color[rgb]{0.627,0.126,0.941},
        captionpos=b,
}

%\usepackage[framemethod=TikZ]{mdframed}
%\mdfdefinestyle{listingstyle}{%
%  backgroundcolor=black!15,outerlinewidth=0.25pt,outerlinecolor=black,%
%  innerleftmargin=5pt,innerrightmargin=5pt,innertopmargin=0pt,innerbottommargin=0pt%
%}
%\BeforeBeginEnvironment{lstlisting}{\begin{mdframed}[style=listingstyle]}
%\AfterEndEnvironment{lstlisting}{\end{mdframed}}

%% special formatting for lstlisting given it has to parse ahead to find ending
\lstnewenvironment{zzlisting}[3]
  {\noindent\minipage{\linewidth}\lstset{label=lst:#1,language=#2,caption={#3}}}
  {\endminipage}
\lstnewenvironment{zzlistingwithpagebreak}[3]
  {\noindent\lstset{label=lst:#1,language=#2,caption={#3}}}
  {}
\newcommand{\zzcode}[1]{\tt #1}

\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}
\lstdefinelanguage{JavaScript}{
  keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break},
  keywordstyle=\color{blue}\bfseries,
  ndkeywords={class, export, boolean, throw, implements, import, this},
%  ndkeywordstyle=\color{darkgray}\bfseries,
  ndkeywordstyle=\color[rgb]{0,.5,1}\bfseries,
%  identifierstyle=\color{black},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
%  commentstyle=\color{purple}\ttfamily,
%  stringstyle=\color{red}\ttfamily,
  morestring=[b]',
  morestring=[b]"
}

%% -- Commands
\newcommand{\zzlistingfile}[4]{%
\lstinputlisting[caption=#4,label=lst:#3,language=#2]{#1}}


%% -- References
\newcommand{\zzlstref}[1]{Listing~\ref{lst:#1}}
\newcommand{\zzlstpref}[1]{on page~\pageref{lst:#1}}
\newcommand{\zzLstref}[1]{Listing~\ref{lst:#1}}
\newcommand{\zzseelst}[1]{see \zzlstref{lst:#1}}
\newcommand{\zzallineref}[2]{\zzalgoref{#1} line~\ref{algoline:#1:#2}}
\newcommand{\zzseeallineref}[2]{(see \zzalref{#1}{#2})}
